<!DOCTYPE html><html lang="en"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>How I generate stock reports with python and latex - Dhanushka&#39;s Blog</title><meta name="description" content="Generating premarket and postmarket reports with python and latex"><meta name="author" content="Dhanushka Jayagoda"><link rel="alternate" type="application/rss+xml" href="/rss.xml"><link rel="icon" type="image/x-icon" href="/favicon.ico"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479144310234386" crossorigin="anonymous"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6"></script><script type="text/javascript">
      let slideIndex = 1;
      showSlides(slideIndex);

      function plusSlides(n) {
        showSlides((slideIndex += n));
      }

      function currentSlide(n) {
        showSlides((slideIndex = n));
      }

      function showSlides(n) {
        try {
          let i;
          let slides = document.getElementsByClassName('mySlides');
          let dots = document.getElementsByClassName('demo');
          let captionText = document.getElementById('caption');
          if (n > slides.length) {
            slideIndex = 1;
          }
          if (n < 1) {
            slideIndex = slides.length;
          }
          for (i = 0; i < slides.length; i++) {
            slides[i].style.display = 'none';
          }
          for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(' active', '');
          }
          slides[slideIndex - 1].style.display = 'block';
          dots[slideIndex - 1].className += ' active';
          captionText.innerHTML = dots[slideIndex - 1].alt;
        } catch (err) {
          // do nothing here
        }
      }
    </script><!-- Google Tag Manager --><!-- End Google Tag Manager --><link rel="stylesheet" href="/_astro/index.BsaAxKtc.css" />
<style>.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);-webkit-clip-path:inset(50%);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}@media print{.no-print,.no-print *{display:none!important}}
</style><script type="module" src="/_astro/hoisted.UksxmqGZ.js"></script></head> <body class="bg-slate-900 text-gray-100"> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K8P5P8FQ" height="0" width="0" style="display:none;visibility:hidden"></iframe> </noscript> <!-- End Google Tag Manager (noscript) --> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="flex flex-col gap-y-3 sm:flex-row sm:items-center sm:justify-between"><a href="/"><div class="flex items-center bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text text-xl font-bold text-transparent"><svg class="mr-1 h-10 w-10 stroke-cyan-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none"></path><rect x="3" y="12" width="6" height="8" rx="1"></rect><rect x="9" y="8" width="6" height="12" rx="1"></rect><rect x="15" y="4" width="6" height="16" rx="1"></rect><path d="M4 20h14"></path></svg>Dhanushka&#x27;s Blog</div></a><nav><ul class="flex gap-x-3 font-medium text-gray-200"><li class="hover:text-white"><a href="/posts">Blogs</a></li><li class="hover:text-white"><a href="https://github.com/dhanushka2001/blog-astro">GitHub</a></li><li class="hover:text-white"><a href="/photos">Photos</a></li></ul></nav></div></div> <div data-pagefind-body>  <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var v=Object.defineProperty;var A=(c,s,a)=>s in c?v(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a;var d=(c,s,a)=>(A(c,typeof s!="symbol"?s+"":s,a),a);var u;{let c={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},s=t=>{let[e,n]=t;return e in c?c[e](n):void 0},a=t=>t.map(s),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,s(n)]));customElements.get("astro-island")||customElements.define("astro-island",(u=class extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var f;if(!this.hydrator||!this.isConnected)return;let e=(f=this.parentElement)==null?void 0:f.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),r={},l=this.querySelectorAll("template[data-astro-template]");for(let o of l){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("data-astro-template")||"default"]=o.innerHTML,o.remove())}for(let o of n){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("name")||"default"]=o.innerHTML)}let h;try{h=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(o){let i=this.getAttribute("component-url")||"<unknown>",b=this.getAttribute("component-export");throw b&&(i+=` (export ${b})`),console.error(`[hydrate] Error parsing props for component ${i}`,this.getAttribute("props"),o),o}let p;await this.hydrator(this)(this.Component,h,r,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),n.disconnect(),this.childrenConnectedCallback()},n=new MutationObserver(()=>{var r;((r=this.lastChild)==null?void 0:r.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});n.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}try{await Astro[n](async()=>{let r=this.getAttribute("renderer-url"),[l,{default:h}]=await Promise.all([import(this.getAttribute("component-url")),r?import(r):()=>()=>{}]),p=this.getAttribute("component-export")||"default";if(!p.includes("."))this.Component=l[p];else{this.Component=l;for(let y of p.split("."))this.Component=this.Component[y]}return this.hydrator=h,this.hydrate},e,this)}catch(r){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,r)}}attributeChangedCallback(){this.hydrate()}},d(u,"observedAttributes",["props"]),u))}})();</script><astro-island uid="ZFy5E" prefix="r2" component-url="/_astro/BlogPost.BdPqyukv.js" component-export="default" renderer-url="/_astro/client.D9Vng9vH.js" props="{&quot;frontmatter&quot;:[0,{&quot;tags&quot;:[1,[[0,&quot;python&quot;],[0,&quot;latex&quot;],[0,&quot;openbb&quot;]]],&quot;title&quot;:[0,&quot;How I generate stock reports with python and latex&quot;],&quot;description&quot;:[0,&quot;Generating premarket and postmarket reports with python and latex&quot;],&quot;pubDate&quot;:[0,&quot;Mon, 20 March 2023&quot;],&quot;imgSrc&quot;:[0,&quot;/imgs/2023/1678591372_a_blade_in_the_desert_under_the_sun.png&quot;],&quot;authors&quot;:[1,[[0,&quot;David Li&quot;]]],&quot;file&quot;:[0,&quot;/home/runner/work/blog-astro/blog-astro/src/pages/posts/stonks/web/generating_stonk_reports_with_python.md&quot;],&quot;url&quot;:[0,&quot;/posts/stonks/web/generating_stonk_reports_with_python&quot;]}]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;BlogPost&quot;,&quot;value&quot;:true}" await-children=""><div class="mx-auto max-w-screen-lg px-3 py-6"><div><h1 class="text-center text-3xl font-bold">How I generate stock reports with python and latex</h1><div class="text-center text-sm text-gray-400"><div class="mt-1">Published:<!-- --> <!-- -->Mar 20, 2023</div><div class="mt-2 flex flex-wrap items-center justify-center gap-4"><div class="flex items-center space-x-2"><img src="/assets/images/avatars/david.png" alt="David Li" class="h-6 w-6 rounded-full object-cover" loading="lazy"/><a href="https://github.com/FriendlyUser" target="_blank" rel="noopener noreferrer" class="hover:underline">David Li</a></div></div></div><div class="flex place-content-center pt-2"><div class="rounded-md px-2 py-1 text-xs font-semibold bg-green-400 text-green-900"> <a href="/tags/python" style="padding-right:3px"> <category>python<!-- --> </category></a></div> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/latex" style="padding-right:3px"> <category>latex<!-- --> </category></a></div> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/openbb" style="padding-right:3px"> <category>openbb<!-- --> </category></a></div> </div><div class="mx-auto mt-5 max-w-prose"><div class="aspect-h-2 aspect-w-3"><img class="h-full w-full rounded-lg object-cover object-center" src="/imgs/2023/1678591372_a_blade_in_the_desert_under_the_sun.png" loading="lazy"/></div><div class="prose prose-invert mt-6 prose-img:rounded-lg"><content><astro-slot> <p>Premarket refers to the trading activity that occurs before the regular market hours. In the United States, the regular market hours are 9:30 AM to 4:00 PM Eastern Time. The premarket session usually starts at 4:00 AM Eastern Time and ends at 9:30 AM Eastern Time. During the premarket session, investors can trade stocks through electronic communication networks (ECNs) that are open for trading.</p>
<p>The premarket session provides an opportunity for investors to trade stocks ahead of important market-moving events such as earnings releases or economic data releases. The trading volume and liquidity during the premarket session are usually lower compared to the regular market hours, so investors should be aware that the prices may be more volatile and less accurate.</p>
<p>It’s worth noting that not all stocks are available for trading during the premarket session, and the prices quoted during this time may not necessarily be indicative of the prices that will be available during the regular market hours.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672"> import</span><span style="color:#F8F8F2"> sys</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F"># all tex related stuff is in src/tex.py</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> numpy </span><span style="color:#F92672">as</span><span style="color:#F8F8F2"> np</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> pylatex </span><span style="color:#F92672">as</span><span style="color:#F8F8F2"> pl</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> pandas </span><span style="color:#F92672">as</span><span style="color:#F8F8F2"> pd</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> datetime</span></span>
<span class="line"><span style="color:#F92672">from</span><span style="color:#F8F8F2"> marketwatch </span><span style="color:#F92672">import</span><span style="color:#F8F8F2"> split_tables</span></span>
<span class="line"><span style="color:#F92672">from</span><span style="color:#F8F8F2"> utils.parse_reddit </span><span style="color:#F92672">import</span><span style="color:#F8F8F2"> fetch_reddit_posts, parse_reddit_posts, make_dirs</span></span>
<span class="line"><span style="color:#F92672">from</span><span style="color:#F8F8F2"> utils.tex </span><span style="color:#F92672">import</span><span style="color:#F8F8F2"> escape_latex</span></span>
<span class="line"><span style="color:#F92672">from</span><span style="color:#F8F8F2"> utils.openbb_data </span><span style="color:#F92672">import</span><span style="color:#F8F8F2"> openbb_economy</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> main</span><span style="color:#F8F8F2">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    doc </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> pl.Document()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    doc.packages.append(pl.Package(</span><span style="color:#E6DB74">'booktabs'</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    doc.packages.append(pl.Package(</span><span style="color:#E6DB74">'adjustbox'</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">    doc.packages.append(pl.Package(</span><span style="color:#E6DB74">"hyperref"</span><span style="color:#F8F8F2">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    dfs, captions </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> split_tables()</span></span>
<span class="line"><span style="color:#88846F">    # MARKET EVENTS</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> index, df </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> enumerate</span><span style="color:#F8F8F2">(dfs):</span></span>
<span class="line"><span style="color:#88846F">        # only add these ta</span></span>
<span class="line"><span style="color:#F92672">        try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">            column_format </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> 'l'</span><span style="color:#F92672"> +</span><span style="color:#E6DB74"> 'c'</span><span style="color:#F92672"> *</span><span style="color:#F8F8F2"> (</span><span style="color:#66D9EF">len</span><span style="color:#F8F8F2">(df.columns) </span><span style="color:#F92672">-</span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            tex_table </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> df.to_latex(</span><span style="color:#FD971F;font-style:italic">escape</span><span style="color:#F92672">=</span><span style="color:#AE81FF">True</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">index</span><span style="color:#F92672">=</span><span style="color:#AE81FF">False</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">column_format</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">column_format)</span></span>
<span class="line"><span style="color:#F92672">            with</span><span style="color:#F8F8F2"> doc.create(pl.Table(</span><span style="color:#FD971F;font-style:italic">position</span><span style="color:#F92672">=</span><span style="color:#E6DB74">'htbp'</span><span style="color:#F8F8F2">)) </span><span style="color:#F92672">as</span><span style="color:#F8F8F2"> table:</span></span>
<span class="line"><span style="color:#F8F8F2">                table.add_caption(captions[index])</span></span>
<span class="line"><span style="color:#F8F8F2">                table.append(pl.Command(</span><span style="color:#E6DB74">'centering'</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">                doc.append(pl.NoEscape(</span><span style="color:#66D9EF;font-style:italic">r</span><span style="color:#E6DB74">'\begin{adjustbox}{width=1</span><span style="color:#AE81FF">\t</span><span style="color:#E6DB74">extwidth}'</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">                table.append(pl.NoEscape(tex_table))</span></span>
<span class="line"><span style="color:#F8F8F2">                doc.append(pl.NoEscape(</span><span style="color:#66D9EF;font-style:italic">r</span><span style="color:#E6DB74">'</span><span style="color:#AE81FF">\e</span><span style="color:#E6DB74">nd{adjustbox}'</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F92672">        except</span><span style="color:#66D9EF;font-style:italic"> Exception</span><span style="color:#F92672"> as</span><span style="color:#F8F8F2"> e:</span></span>
<span class="line"><span style="color:#66D9EF">            print</span><span style="color:#F8F8F2">(e)</span></span>
<span class="line"><span style="color:#88846F">    # PULL REDDIT DATA</span></span>
<span class="line"><span style="color:#88846F">    # </span><span style="color:#F92672">TODO</span><span style="color:#88846F"> integrate custom commands</span></span>
<span class="line"><span style="color:#88846F">    # eventually https://jeltef.github.io/PyLaTeX/current/examples/own_commands_ex.html</span></span>
<span class="line"><span style="color:#F8F8F2">    reddit_posts </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> fetch_reddit_posts()</span></span>
<span class="line"><span style="color:#88846F">    # eventually do a md framed component per post</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> reddit_posts </span><span style="color:#F92672">is</span><span style="color:#F92672"> not</span><span style="color:#AE81FF"> None</span><span style="color:#F92672"> and</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(reddit_posts) </span><span style="color:#F92672">></span><span style="color:#AE81FF"> 0</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        df_posts </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> parse_reddit_posts(reddit_posts)</span></span>
<span class="line"><span style="color:#88846F">        # add reddit post to tex report</span></span>
<span class="line"><span style="color:#F92672">        with</span><span style="color:#F8F8F2"> doc.create(pl.Itemize()) </span><span style="color:#F92672">as</span><span style="color:#F8F8F2"> itemize:</span></span>
<span class="line"><span style="color:#F92672">            for</span><span style="color:#F8F8F2"> index, row </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> df_posts.iterrows():</span></span>
<span class="line"><span style="color:#F8F8F2">                itemize.add_item(pl.NoEscape(</span><span style="color:#66D9EF;font-style:italic">r</span><span style="color:#E6DB74">"</span><span style="color:#AE81FF">\h</span><span style="color:#E6DB74">ref{"</span><span style="color:#F92672"> +</span><span style="color:#F8F8F2"> escape_latex(row[</span><span style="color:#E6DB74">'url'</span><span style="color:#F8F8F2">]) </span><span style="color:#F92672">+</span><span style="color:#66D9EF;font-style:italic"> r</span><span style="color:#E6DB74">"}{"</span><span style="color:#F92672"> +</span><span style="color:#F8F8F2"> escape_latex(row[</span><span style="color:#E6DB74">'title'</span><span style="color:#F8F8F2">]) </span><span style="color:#F92672">+</span><span style="color:#66D9EF;font-style:italic"> r</span><span style="color:#E6DB74">"},"</span><span style="color:#F92672"> +</span><span style="color:#F8F8F2"> escape_latex(row[</span><span style="color:#E6DB74">"linkFlairText"</span><span style="color:#F8F8F2">])))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    economy_dfs, file_names </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> openbb_economy()</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> index, df </span><span style="color:#F92672">in</span><span style="color:#66D9EF"> enumerate</span><span style="color:#F8F8F2">(economy_dfs):</span></span>
<span class="line"><span style="color:#F8F8F2">        tex_table </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> df.to_latex(</span><span style="color:#FD971F;font-style:italic">escape</span><span style="color:#F92672">=</span><span style="color:#AE81FF">True</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">index</span><span style="color:#F92672">=</span><span style="color:#AE81FF">False</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">        with</span><span style="color:#F8F8F2"> doc.create(pl.Table(</span><span style="color:#FD971F;font-style:italic">position</span><span style="color:#F92672">=</span><span style="color:#E6DB74">'htbp'</span><span style="color:#F8F8F2">)) </span><span style="color:#F92672">as</span><span style="color:#F8F8F2"> table:</span></span>
<span class="line"><span style="color:#F8F8F2">            table.add_caption(file_names[index])</span></span>
<span class="line"><span style="color:#F8F8F2">            table.append(pl.Command(</span><span style="color:#E6DB74">'centering'</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">            doc.append(pl.NoEscape(</span><span style="color:#66D9EF;font-style:italic">r</span><span style="color:#E6DB74">'\begin{adjustbox}{width=1</span><span style="color:#AE81FF">\t</span><span style="color:#E6DB74">extwidth}'</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#F8F8F2">            table.append(pl.NoEscape(tex_table))</span></span>
<span class="line"><span style="color:#F8F8F2">            doc.append(pl.NoEscape(</span><span style="color:#66D9EF;font-style:italic">r</span><span style="color:#E6DB74">'</span><span style="color:#AE81FF">\e</span><span style="color:#E6DB74">nd{adjustbox}'</span><span style="color:#F8F8F2">))</span></span>
<span class="line"><span style="color:#88846F">    # make images</span></span>
<span class="line"><span style="color:#88846F">    # make dirs files</span></span>
<span class="line"><span style="color:#F8F8F2">    curr_month </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> datetime.datetime.now().strftime(</span><span style="color:#E6DB74">"%B"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    base_folder </span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic"> f</span><span style="color:#E6DB74">"data/reports/</span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">curr_month</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74">"</span></span>
<span class="line"><span style="color:#F8F8F2">    make_dirs(base_folder)</span></span>
<span class="line"><span style="color:#F8F8F2">    output_path </span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic"> f</span><span style="color:#E6DB74">"</span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">base_folder</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74">/report_</span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">datetime.datetime.now().strftime(</span><span style="color:#E6DB74">'%Y_%m_</span><span style="color:#AE81FF">%d</span><span style="color:#E6DB74">'</span><span style="color:#F8F8F2">)</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74">_pre"</span></span>
<span class="line"><span style="color:#F8F8F2">    doc.generate_tex(output_path)</span></span>
<span class="line"><span style="color:#F8F8F2">    doc.generate_tex(</span><span style="color:#E6DB74">"data/latest"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">if</span><span style="color:#F8F8F2"> __name__ </span><span style="color:#F92672">==</span><span style="color:#E6DB74"> '__main__'</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">    main()</span></span>
<span class="line"><span style="color:#F8F8F2"> </span></span></code></pre>
<p>This code is a script for generating a LaTeX report on stock market data. The report includes information about market events and economy, as well as data from Reddit posts. The script makes use of several imported modules and functions, including:</p>
<ul>
<li><code>numpy</code> and <code>pandas</code> for numerical and data manipulation, respectively.</li>
<li><code>pylatex</code> to generate a LaTeX report.</li>
<li><code>split_tables</code> from <code>marketwatch</code> to obtain data on market events.</li>
<li><code>fetch_reddit_posts</code> and <code>parse_reddit_posts</code> from <code>parse_reddit</code> to fetch and parse data from Reddit posts.</li>
<li><code>make_dirs</code> from <code>utils.parse_reddit</code> to create necessary directories.</li>
<li><code>openbb_economy</code> from <code>openbb_data</code> to obtain data on the economy.</li>
</ul>
<p>The code first creates a LaTeX document and adds some necessary packages for formatting. It then retrieves data on market events and economy and formats it into LaTeX tables, which are added to the report. The code also fetches and parses data from Reddit posts and adds it to the report as a list. Finally, the code generates the LaTeX report and saves it to a file.</p>
<p>The fetch_reddit command calls a function from my finreddit project available on github at <a href="https://github.com/dli-invest/finreddit">finreddit</a> and the corresponding article is at <a href="https://friendlyuser.github.io/posts/stonks/web/scrapping_comments_from_reddit/">scrapping comments from reddit</a></p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#88846F"> # parse reddit data resulting from subprocess into pandas dataframe</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> pandas </span><span style="color:#F92672">as</span><span style="color:#F8F8F2"> pd</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> subprocess</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> datetime</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> os</span></span>
<span class="line"><span style="color:#F92672">from</span><span style="color:#F8F8F2"> io </span><span style="color:#F92672">import</span><span style="color:#F8F8F2"> StringIO</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> fetch_reddit_posts</span><span style="color:#F8F8F2">():</span></span>
<span class="line"><span style="color:#F92672">    try</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        output </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> subprocess.run(</span><span style="color:#E6DB74">"go run main.go"</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">shell</span><span style="color:#F92672">=</span><span style="color:#AE81FF">True</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">cwd</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"tools/reddit"</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">capture_output</span><span style="color:#F92672">=</span><span style="color:#AE81FF">True</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        raw_text </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> output.stdout.decode(</span><span style="color:#E6DB74">"utf-8"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#88846F">        # read raw text in csv format in pandas df</span></span>
<span class="line"><span style="color:#F8F8F2">        csvStringIO </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> StringIO(raw_text)</span></span>
<span class="line"><span style="color:#66D9EF">        print</span><span style="color:#F8F8F2">(raw_text)</span></span>
<span class="line"><span style="color:#F8F8F2">        df </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> pd.read_csv(csvStringIO, </span><span style="color:#FD971F;font-style:italic">sep</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"</span><span style="color:#AE81FF">\t</span><span style="color:#E6DB74">"</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">on_bad_lines</span><span style="color:#F92672">=</span><span style="color:#E6DB74">'warn'</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#F8F8F2"> df</span></span>
<span class="line"><span style="color:#F92672">    except</span><span style="color:#66D9EF;font-style:italic"> Exception</span><span style="color:#F92672"> as</span><span style="color:#F8F8F2"> e:</span></span>
<span class="line"><span style="color:#66D9EF">        print</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"FAILING TO PARSE ARTICLES"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#66D9EF">        print</span><span style="color:#F8F8F2">(e)</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#AE81FF"> None</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> make_dirs</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">path</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">) -> </span><span style="color:#AE81FF">None</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F92672"> not</span><span style="color:#F8F8F2"> os.path.exists(path):</span></span>
<span class="line"><span style="color:#F8F8F2">        os.makedirs(path)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> parse_reddit_posts</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">df</span><span style="color:#F8F8F2">: pd.DataFrame)-> </span><span style="color:#AE81FF">None</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#88846F">    # get curr month from curr date</span></span>
<span class="line"><span style="color:#F8F8F2">    curr_month </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> datetime.datetime.now().strftime(</span><span style="color:#E6DB74">"%B"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    base_folder </span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic"> f</span><span style="color:#E6DB74">"data/reddit/</span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">curr_month</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74">"</span></span>
<span class="line"><span style="color:#F8F8F2">    make_dirs(base_folder)</span></span>
<span class="line"><span style="color:#88846F">    # date in YYYY_MM_DD format plus - pre/post</span></span>
<span class="line"><span style="color:#F8F8F2">    file_name </span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic"> f</span><span style="color:#E6DB74">"</span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">datetime.datetime.now().strftime(</span><span style="color:#E6DB74">'%Y_%m_</span><span style="color:#AE81FF">%d</span><span style="color:#E6DB74">'</span><span style="color:#F8F8F2">)</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74">_pre.csv"</span></span>
<span class="line"><span style="color:#88846F">    # make folder for reddit data</span></span>
<span class="line"><span style="color:#F8F8F2">    csv_path </span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic"> f</span><span style="color:#E6DB74">"</span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">base_folder</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74">/</span><span style="color:#AE81FF">{</span><span style="color:#F8F8F2">file_name</span><span style="color:#AE81FF">}</span><span style="color:#E6DB74">"</span></span>
<span class="line"><span style="color:#F8F8F2">    df.to_csv(csv_path, </span><span style="color:#FD971F;font-style:italic">index</span><span style="color:#F92672">=</span><span style="color:#AE81FF">False</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> df</span></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> main</span><span style="color:#F8F8F2">():</span></span>
<span class="line"><span style="color:#F8F8F2">    df </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> fetch_reddit_posts()</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> df </span><span style="color:#F92672">is</span><span style="color:#F92672"> not</span><span style="color:#AE81FF"> None</span><span style="color:#F92672"> and</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(df) </span><span style="color:#F92672">></span><span style="color:#AE81FF"> 0</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">        parse_reddit_posts(df)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">if</span><span style="color:#F8F8F2"> __name__ </span><span style="color:#F92672">==</span><span style="color:#E6DB74"> '__main__'</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">    main()</span></span>
<span class="line"><span style="color:#F8F8F2"> </span></span></code></pre>
<p>This code appears to scrape Reddit data using the <code>go run main.go</code> command, which is run via a subprocess in Python. The data is then processed and saved as a CSV file in a specified directory.</p>
<p>The <code>fetch_reddit_posts</code> function runs the <code>go run main.go</code> command using the <code>subprocess.run</code> method, captures the output of the command, and decodes it into a string. The string is then passed as an argument to the <code>pd.read_csv</code> function and saved as a pandas DataFrame.</p>
<p>The <code>make_dirs</code> function creates a new directory if it doesn’t already exist. The <code>parse_reddit_posts</code> function formats the current date and uses it to create a directory path to store the data, along with a filename based on the date and the string “pre” or “post.” The resulting DataFrame is then saved to a CSV file in the specified location.</p>
<p>The <code>main</code> function calls the <code>fetch_reddit_posts</code> function, checks if the returned DataFrame is not <code>None</code> and has a length greater than 0, and if so, calls the <code>parse_reddit_posts</code> function and passes the DataFrame to it as an argument.</p>
<p>Finally, the code sets up an <code>if __name__ == '__main__':</code> block, which calls the <code>main</code> function when the code is run as a standalone script.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F8F8F2"> package main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> (</span></span>
<span class="line"><span style="color:#F92672">	//</span><span style="color:#E6DB74"> "os"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6DB74">	"github.com/dli-invest/finreddit/pkg/reddit"</span></span>
<span class="line"><span style="color:#F8F8F2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">func main() {</span></span>
<span class="line"><span style="color:#F8F8F2">	reddit.ScanSRs(</span><span style="color:#E6DB74">"investing.yml"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">	//</span><span style="color:#F8F8F2"> argsWithProg := os.Args</span></span>
<span class="line"><span style="color:#F92672">	//</span><span style="color:#F92672"> if</span><span style="color:#66D9EF"> len</span><span style="color:#F8F8F2">(argsWithProg) </span><span style="color:#F92672">></span><span style="color:#AE81FF"> 1</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F92672">	//</span><span style="color:#F8F8F2"> 	reddit.ScanSRs(argsWithProg[</span><span style="color:#AE81FF">1</span><span style="color:#F8F8F2">])</span></span>
<span class="line"><span style="color:#F92672">	//</span><span style="color:#F8F8F2"> } </span><span style="color:#F92672">else</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#F92672">	//</span><span style="color:#F8F8F2"> 	panic(</span><span style="color:#E6DB74">"No arguments passed in"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F92672">	//</span><span style="color:#F8F8F2"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">}</span></span>
<span class="line"><span style="color:#F8F8F2"> </span></span></code></pre>
<p>This is the Go code for the main function of a Reddit scrapper tool. The function calls the <code>ScanSRs</code> method from the <code>reddit</code> package, passing the file name “investing.yml” as an argument. The <code>ScanSRs</code> method takes a file name as an argument, which specifies the subreddit names to be scanned. The function does not provide any error handling in case the file does not exist, which may cause the application to panic. A possible improvement would be to add error handling to handle cases where the file does not exist, or the file name argument is missing.</p>
<p>Generating stock reports is important for several reasons:</p>
<ol>
<li>Monitoring performance: Stock reports provide a comprehensive view of a company’s financial performance and help to track its progress over time. They can help investors make informed decisions about whether to buy, sell, or hold a stock.</li>
<li>Compliance: Publicly traded companies are required to file regular reports with regulatory bodies such as the Securities and Exchange Commission (SEC). These reports provide transparency and accountability to the public and help to ensure compliance with financial reporting regulations.</li>
<li>Investors: Stock reports provide investors with key financial information, including revenue, expenses, profits, and cash flow. They can use this information to make informed investment decisions and evaluate the financial health of a company.</li>
<li>Management: Stock reports can also help management to identify areas of the business that need improvement and track the company’s progress towards achieving its goals. They can be used as a tool for planning and decision-making, and to measure the success of strategies and initiatives.</li>
</ol>
<p>Overall, generating stock reports is an important aspect of financial reporting that provides valuable information to investors, management, and regulators.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672"> import</span><span style="color:#F8F8F2"> os </span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> requests</span></span>
<span class="line"><span style="color:#F92672">import</span><span style="color:#F8F8F2"> argparse</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">def</span><span style="color:#A6E22E"> send_file</span><span style="color:#F8F8F2">(</span><span style="color:#FD971F;font-style:italic">path</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">content</span><span style="color:#F92672"> =</span><span style="color:#E6DB74"> "MarketWatch Report"</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">username</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"Marketwatch"</span><span style="color:#F8F8F2">) -> </span><span style="color:#AE81FF">None</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#E6DB74">    """ send discord file from path to discord using requests"""</span></span>
<span class="line"><span style="color:#F8F8F2">    url </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> os.getenv(</span><span style="color:#E6DB74">"DISCORD_WEBHOOK"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    files </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> {</span><span style="color:#E6DB74">'file'</span><span style="color:#F8F8F2">: </span><span style="color:#66D9EF">open</span><span style="color:#F8F8F2">(path, </span><span style="color:#E6DB74">'rb'</span><span style="color:#F8F8F2">)}</span></span>
<span class="line"><span style="color:#F8F8F2">    data </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#E6DB74">        "username"</span><span style="color:#F8F8F2">: username,</span></span>
<span class="line"><span style="color:#E6DB74">        "content"</span><span style="color:#F8F8F2">: content,</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">    requests.post(url, </span><span style="color:#FD971F;font-style:italic">files</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">files, </span><span style="color:#FD971F;font-style:italic">data</span><span style="color:#F92672">=</span><span style="color:#F8F8F2">data)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">    </span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">if</span><span style="color:#F8F8F2"> __name__ </span><span style="color:#F92672">==</span><span style="color:#E6DB74"> '__main__'</span><span style="color:#F8F8F2">:</span></span>
<span class="line"><span style="color:#F8F8F2">    parser </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> argparse.ArgumentParser()</span></span>
<span class="line"><span style="color:#F8F8F2">    parser.add_argument(</span><span style="color:#E6DB74">"--path"</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">type</span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">required</span><span style="color:#F92672">=</span><span style="color:#AE81FF">False</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">default</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"latest.pdf"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    parser.add_argument(</span><span style="color:#E6DB74">"--content"</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">type</span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">required</span><span style="color:#F92672">=</span><span style="color:#AE81FF">False</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">default</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"MarketWatch Report"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    parser.add_argument(</span><span style="color:#E6DB74">"--username"</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">type</span><span style="color:#F92672">=</span><span style="color:#66D9EF;font-style:italic">str</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">required</span><span style="color:#F92672">=</span><span style="color:#AE81FF">False</span><span style="color:#F8F8F2">, </span><span style="color:#FD971F;font-style:italic">default</span><span style="color:#F92672">=</span><span style="color:#E6DB74">"Marketwatch"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    args </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> parser.parse_args()</span></span>
<span class="line"><span style="color:#F8F8F2">    send_file(args.path, args.content, args.username) </span></span></code></pre>
<p>This script sends a file located at <code>path</code> to a Discord channel using a Discord webhook URL. The webhook URL is retrieved from an environment variable named “DISCORD_WEBHOOK”. The script also accepts optional arguments for the file’s content and the Discord username to display when sending the file. The file is sent using a <code>POST</code> request to the Discord webhook URL with the file and the content and username data in the request body.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://github.com/dli-invest/stonk_events">https://github.com/dli-invest/stonk_events</a></li>
<li><a href="https://friendlyuser.github.io/posts/stonks/web/scrapping_comments_from_reddit/">https://friendlyuser.github.io/posts/stonks/web/scrapping_comments_from_reddit/</a></li>
<li><a href="https://friendlyuser.github.io/posts/tech/python/simple_deta_micro_service_to_view_uploaded_files">https://friendlyuser.github.io/posts/tech/python/simple_deta_micro_service_to_view_uploaded_files</a></li>
</ul> </astro-slot></content></div></div></div></div><!--astro:end--></astro-island>  </div> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="no-print border-t border-gray-600 pt-5"><div class="text-sm text-gray-200">© Copyright <!-- -->2025<!-- --> by <!-- -->Dhanushka&#x27;s Blog<!-- -->. Built with ♥ by<!-- --> <a class="text-cyan-400 hover:underline" href="https://github.com/dhanushka2001" target="_blank" rel="noopener noreferrer">Dhanushka</a>. Last updated on <!-- -->2025-07-08<!-- -->.</div></div><script src="https://cdn.botpress.cloud/webchat/v0/inject.js"></script><script src="https://mediafiles.botpress.cloud/0df54034-3318-451a-aed0-3923a4ee25a5/webchat/config.js" defer=""></script></div> </body></html>