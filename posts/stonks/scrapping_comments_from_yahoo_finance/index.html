<!DOCTYPE html><html lang="en"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Scrapping comments from Yahoo Finance using dotnet - Dhanushka&#39;s Blog</title><meta name="description" content="Explaining how conscrap project grabs comments from yahoo finance using selenium."><meta name="author" content="Dhanushka Jayagoda"><link rel="alternate" type="application/rss+xml" href="/rss.xml"><link rel="icon" type="image/x-icon" href="/favicon.ico"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2479144310234386" crossorigin="anonymous"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-119155027-6"></script><script type="text/javascript">
      let slideIndex = 1;
      showSlides(slideIndex);

      function plusSlides(n) {
        showSlides((slideIndex += n));
      }

      function currentSlide(n) {
        showSlides((slideIndex = n));
      }

      function showSlides(n) {
        try {
          let i;
          let slides = document.getElementsByClassName('mySlides');
          let dots = document.getElementsByClassName('demo');
          let captionText = document.getElementById('caption');
          if (n > slides.length) {
            slideIndex = 1;
          }
          if (n < 1) {
            slideIndex = slides.length;
          }
          for (i = 0; i < slides.length; i++) {
            slides[i].style.display = 'none';
          }
          for (i = 0; i < dots.length; i++) {
            dots[i].className = dots[i].className.replace(' active', '');
          }
          slides[slideIndex - 1].style.display = 'block';
          dots[slideIndex - 1].className += ' active';
          captionText.innerHTML = dots[slideIndex - 1].alt;
        } catch (err) {
          // do nothing here
        }
      }
    </script><!-- Google Tag Manager --><!-- End Google Tag Manager --><link rel="stylesheet" href="/_astro/index.BsaAxKtc.css" />
<style>.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);-webkit-clip-path:inset(50%);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}@media print{.no-print,.no-print *{display:none!important}}
</style><script type="module" src="/_astro/hoisted.UksxmqGZ.js"></script></head> <body class="bg-slate-900 text-gray-100"> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K8P5P8FQ" height="0" width="0" style="display:none;visibility:hidden"></iframe> </noscript> <!-- End Google Tag Manager (noscript) --> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="flex flex-col gap-y-3 sm:flex-row sm:items-center sm:justify-between"><a href="/"><div class="flex items-center bg-gradient-to-br from-sky-500 to-cyan-400 bg-clip-text text-xl font-bold text-transparent"><svg class="mr-1 h-10 w-10 stroke-cyan-600" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none"></path><rect x="3" y="12" width="6" height="8" rx="1"></rect><rect x="9" y="8" width="6" height="12" rx="1"></rect><rect x="15" y="4" width="6" height="16" rx="1"></rect><path d="M4 20h14"></path></svg>Dhanushka&#x27;s Blog</div></a><nav><ul class="flex gap-x-3 font-medium text-gray-200"><li class="hover:text-white"><a href="/posts">Blogs</a></li><li class="hover:text-white"><a href="https://github.com/dhanushka2001/blog-astro">GitHub</a></li><li class="hover:text-white"><a href="/photos">Photos</a></li></ul></nav></div></div> <div data-pagefind-body>  <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).load=e;window.dispatchEvent(new Event("astro:load"));})();;(()=>{var v=Object.defineProperty;var A=(c,s,a)=>s in c?v(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a;var d=(c,s,a)=>(A(c,typeof s!="symbol"?s+"":s,a),a);var u;{let c={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},s=t=>{let[e,n]=t;return e in c?c[e](n):void 0},a=t=>t.map(s),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([e,n])=>[e,s(n)]));customElements.get("astro-island")||customElements.define("astro-island",(u=class extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var f;if(!this.hydrator||!this.isConnected)return;let e=(f=this.parentElement)==null?void 0:f.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let n=this.querySelectorAll("astro-slot"),r={},l=this.querySelectorAll("template[data-astro-template]");for(let o of l){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("data-astro-template")||"default"]=o.innerHTML,o.remove())}for(let o of n){let i=o.closest(this.tagName);i!=null&&i.isSameNode(this)&&(r[o.getAttribute("name")||"default"]=o.innerHTML)}let h;try{h=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(o){let i=this.getAttribute("component-url")||"<unknown>",b=this.getAttribute("component-export");throw b&&(i+=` (export ${b})`),console.error(`[hydrate] Error parsing props for component ${i}`,this.getAttribute("props"),o),o}let p;await this.hydrator(this)(this.Component,h,r,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),n.disconnect(),this.childrenConnectedCallback()},n=new MutationObserver(()=>{var r;((r=this.lastChild)==null?void 0:r.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});n.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),n=this.getAttribute("client");if(Astro[n]===void 0){window.addEventListener(`astro:${n}`,()=>this.start(),{once:!0});return}try{await Astro[n](async()=>{let r=this.getAttribute("renderer-url"),[l,{default:h}]=await Promise.all([import(this.getAttribute("component-url")),r?import(r):()=>()=>{}]),p=this.getAttribute("component-export")||"default";if(!p.includes("."))this.Component=l[p];else{this.Component=l;for(let y of p.split("."))this.Component=this.Component[y]}return this.hydrator=h,this.hydrate},e,this)}catch(r){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,r)}}attributeChangedCallback(){this.hydrate()}},d(u,"observedAttributes",["props"]),u))}})();</script><astro-island uid="BkzoS" prefix="r3" component-url="/_astro/BlogPost.BdPqyukv.js" component-export="default" renderer-url="/_astro/client.D9Vng9vH.js" props="{&quot;frontmatter&quot;:[0,{&quot;title&quot;:[0,&quot;Scrapping comments from Yahoo Finance using dotnet&quot;],&quot;description&quot;:[0,&quot;Explaining how conscrap project grabs comments from yahoo finance using selenium.&quot;],&quot;alt&quot;:[0,&quot;Explaining how conscrap project grabs comments from yahoo finance using selenium.&quot;],&quot;pubDate&quot;:[0,&quot;Tuesday, 25 October 2022 13:00:00 GMT&quot;],&quot;tags&quot;:[1,[[0,&quot;dotnet&quot;],[0,&quot;stonks&quot;],[0,&quot;selenium&quot;]]],&quot;projects&quot;:[1,[[0,&quot;conscrap&quot;]]],&quot;imgSrc&quot;:[0,&quot;/imgs/2022/dall-e/DALL·E 2022-10-25 08.48.53 - man slicing through a bench with a katana.png&quot;],&quot;imgAlt&quot;:[0,&quot;Conscrap&quot;],&quot;authors&quot;:[1,[[0,&quot;David Li&quot;]]],&quot;file&quot;:[0,&quot;/home/runner/work/blog-astro/blog-astro/src/pages/posts/stonks/scrapping_comments_from_yahoo_finance.md&quot;],&quot;url&quot;:[0,&quot;/posts/stonks/scrapping_comments_from_yahoo_finance&quot;]}]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;BlogPost&quot;,&quot;value&quot;:true}" await-children=""><div class="mx-auto max-w-screen-lg px-3 py-6"><div><h1 class="text-center text-3xl font-bold">Scrapping comments from Yahoo Finance using dotnet</h1><div class="text-center text-sm text-gray-400"><div class="mt-1">Published:<!-- --> <!-- -->Oct 25, 2022</div><div class="mt-2 flex flex-wrap items-center justify-center gap-4"><div class="flex items-center space-x-2"><img src="/assets/images/avatars/david.png" alt="David Li" class="h-6 w-6 rounded-full object-cover" loading="lazy"/><a href="https://github.com/FriendlyUser" target="_blank" rel="noopener noreferrer" class="hover:underline">David Li</a></div></div></div><div class="flex place-content-center pt-2"><div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/dotnet" style="padding-right:3px"> <category>dotnet<!-- --> </category></a></div> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/stonks" style="padding-right:3px"> <category>stonks<!-- --> </category></a></div> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-cyan-400 text-cyan-900"> <a href="/tags/selenium" style="padding-right:3px"> <category>selenium<!-- --> </category></a></div> </div><div class="mx-auto mt-5 max-w-prose"><div class="aspect-h-2 aspect-w-3"><img class="h-full w-full rounded-lg object-cover object-center" src="/imgs/2022/dall-e/DALL·E 2022-10-25 08.48.53 - man slicing through a bench with a katana.png" alt="Conscrap" loading="lazy"/></div><div class="prose prose-invert mt-6 prose-img:rounded-lg"><content><astro-slot> <h2 id="summary">Summary</h2>
<p>One of my most useful projects is <a href="https://github.com/dli-invest/conscrap">conscrap</a></p>
<p>Like any good web scrapping you have to adhere to rate limits in order to not get blocked.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672">public</span><span style="color:#F92672"> async</span><span style="color:#F92672"> static</span><span> </span><span style="color:#A6E22E;text-decoration:underline">Task</span><span style="color:#A6E22E"> FetchStocks</span><span style="color:#F8F8F2">(</span><span style="color:#F92672">string</span><span style="color:#F8F8F2">[] stocks, </span><span style="color:#F92672">bool</span><span style="color:#F8F8F2"> sendDiscord </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> true</span><span style="color:#F8F8F2">, </span><span style="color:#F92672">string</span><span style="color:#F8F8F2"> dataPath </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> "data"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F92672">    bool</span><span style="color:#F8F8F2"> exists </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> System.IO.Directory.</span><span style="color:#A6E22E">Exists</span><span style="color:#F8F8F2">(dataPath);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#F92672">!</span><span style="color:#F8F8F2">exists)</span></span>
<span class="line"><span style="color:#F8F8F2">        System.IO.Directory.</span><span style="color:#A6E22E">CreateDirectory</span><span style="color:#F8F8F2">(dataPath);</span></span>
<span class="line"><span>    </span><span style="color:#A6E22E;text-decoration:underline">SemaphoreSlim</span><span style="color:#F8F8F2"> discordThrottler </span><span style="color:#F92672">=</span><span style="color:#F92672"> new</span><span> </span><span style="color:#A6E22E;text-decoration:underline">SemaphoreSlim</span><span style="color:#F8F8F2">(</span><span style="color:#AE81FF">30</span><span style="color:#F8F8F2">, </span><span style="color:#AE81FF">30</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span>    </span><span style="color:#A6E22E;text-decoration:underline">SemaphoreSlim</span><span style="color:#F8F8F2"> seleniumThroller </span><span style="color:#F92672">=</span><span style="color:#F92672"> new</span><span> </span><span style="color:#A6E22E;text-decoration:underline">SemaphoreSlim</span><span style="color:#F8F8F2">(</span><span style="color:#AE81FF">5</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#88846F">    // Console.WriteLine(fetchConfig);</span></span>
<span class="line"><span>    </span><span style="color:#A6E22E;text-decoration:underline">Types</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">FetchConfig</span><span style="color:#F8F8F2"> fetchConfig </span><span style="color:#F92672">=</span><span style="color:#F92672"> new</span><span> </span><span style="color:#A6E22E;text-decoration:underline">Types</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">FetchConfig</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        sendDiscord </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> sendDiscord,</span></span>
<span class="line"><span style="color:#F8F8F2">        dataPath </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> dataPath,</span></span>
<span class="line"><span style="color:#F8F8F2">        discordThrottler </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> discordThrottler,</span></span>
<span class="line"><span style="color:#F8F8F2">        seleniumThroller </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> seleniumThroller</span></span>
<span class="line"><span style="color:#F8F8F2">    };</span></span>
<span class="line"><span style="color:#F92672">    foreach</span><span style="color:#F8F8F2"> (</span><span style="color:#F92672">string</span><span style="color:#F8F8F2"> stock </span><span style="color:#F92672">in</span><span style="color:#F8F8F2"> stocks)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F92672">        await</span><span style="color:#A6E22E"> ProcessStock</span><span style="color:#F8F8F2">(stock, fetchConfig);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>The code above is the main function that is called to fetch comments from yahoo finance. It creates a semaphore to throttle the number of discord messages sent at once and another semaphore to throttle the number of selenium instances running at once.</p>
<p>Afterwards it processes each stock in the list of stocks.</p>
<p>In order to process each stock, we need to get all the yahoo comments for that stock.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672">public</span><span style="color:#F92672"> static</span><span> </span><span style="color:#A6E22E;text-decoration:underline">List</span><span style="color:#F8F8F2">&#x3C;</span><span style="color:#A6E22E;text-decoration:underline">Types</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">YahooComment</span><span style="color:#F8F8F2">> </span><span style="color:#A6E22E">GetYahooComments</span><span style="color:#F8F8F2">(</span><span style="color:#F92672">string</span><span style="color:#F8F8F2"> ticker </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> "ACT.CN"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F92672">    string</span><span style="color:#F8F8F2"> readText </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> Browser.</span><span style="color:#A6E22E">GetAllEntries</span><span style="color:#F8F8F2">(ticker);</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">    var</span><span style="color:#F8F8F2"> htmlDoc </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> Parse.</span><span style="color:#A6E22E">MkHtmlDoc</span><span style="color:#F8F8F2">(readText);</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">    var</span><span style="color:#F8F8F2"> yahooData </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> Parse.</span><span style="color:#A6E22E">ExtractYahooConversationsHtml</span><span style="color:#F8F8F2">(readText);</span></span>
<span class="line"><span style="color:#88846F">    // htmlDoc = Parse.MkHtmlDoc(yahooData.ToString());</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">    var</span><span style="color:#F8F8F2"> yahooComments </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> Parse.</span><span style="color:#A6E22E">ExtractComments</span><span style="color:#F8F8F2">(yahooData);</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> yahooComments;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>In order to get all entries we use selenium, sort by newest comments, retry again if it failed and then click on the show more button until there are no more comments to show.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672"> public</span><span style="color:#F92672"> static</span><span style="color:#F92672"> string</span><span style="color:#A6E22E"> GetAllEntries</span><span style="color:#F8F8F2">(</span><span style="color:#F92672">string</span><span style="color:#F8F8F2"> ticker </span><span style="color:#F92672">=</span><span style="color:#E6DB74"> "PKK.CN"</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span>    </span><span style="color:#A6E22E;text-decoration:underline">IWebDriver</span><span style="color:#F8F8F2"> driver </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> Browser.</span><span style="color:#A6E22E">MkBrowser</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#88846F">    // use base url from contant</span></span>
<span class="line"><span style="color:#F92672">    string</span><span style="color:#F8F8F2"> msgUrls </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> String.</span><span style="color:#A6E22E">Format</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"https://finance.yahoo.com/quote/{0}/community?p={0}"</span><span style="color:#F8F8F2">, ticker);</span></span>
<span class="line"><span style="color:#F8F8F2">    Console.</span><span style="color:#A6E22E">WriteLine</span><span style="color:#F8F8F2">(String.</span><span style="color:#A6E22E">Format</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"Parsing messages for {0}"</span><span style="color:#F8F8F2">, ticker));</span></span>
<span class="line"><span style="color:#F8F8F2">    driver.</span><span style="color:#A6E22E">Navigate</span><span style="color:#F8F8F2">().</span><span style="color:#A6E22E">GoToUrl</span><span style="color:#F8F8F2">(msgUrls);</span></span>
<span class="line"><span>    </span><span style="color:#A6E22E;text-decoration:underline">Boolean</span><span style="color:#F8F8F2"> success </span><span style="color:#F92672">=</span><span style="color:#A6E22E"> SortByNewestComments</span><span style="color:#F8F8F2">(driver);</span></span>
<span class="line"><span style="color:#F92672">    if</span><span style="color:#F8F8F2"> (</span><span style="color:#F92672">!</span><span style="color:#F8F8F2">success) </span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        Console.</span><span style="color:#A6E22E">WriteLine</span><span style="color:#F8F8F2">(String.</span><span style="color:#A6E22E">Format</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"Sort By newest Comments failed for {0}"</span><span style="color:#F8F8F2">, ticker));</span></span>
<span class="line"><span style="color:#A6E22E">        SortByNewestComments</span><span style="color:#F8F8F2">(driver);</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#A6E22E">    ShowAllComments</span><span style="color:#F8F8F2">(driver);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#88846F">    // click on all the replies elements</span></span>
<span class="line"><span style="color:#88846F">    // string repliesXPath = Constants.YahooXPaths.repliesXPath;</span></span>
<span class="line"><span style="color:#88846F">    // driver.FindElement(By.ClassName("replies-button")).Click();</span></span>
<span class="line"><span>    </span><span style="color:#A6E22E;text-decoration:underline">OpenQA</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">Selenium</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">Interactions</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">Actions</span><span style="color:#F8F8F2"> action </span><span style="color:#F92672">=</span><span style="color:#F92672"> new</span><span> </span><span style="color:#A6E22E;text-decoration:underline">OpenQA</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">Selenium</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">Interactions</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">Actions</span><span style="color:#F8F8F2">(driver);</span></span>
<span class="line"></span>
<span class="line"><span>    </span><span style="color:#A6E22E;text-decoration:underline">String</span><span style="color:#F8F8F2"> pageSource </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> driver.PageSource;</span></span>
<span class="line"><span style="color:#88846F">    // System.IO.File.WriteAllText(@"WriteText.txt", pageSource);</span></span>
<span class="line"><span style="color:#F92672">    return</span><span style="color:#F8F8F2"> pageSource;</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>In order to sort by SortByNewestComments we need to click on the sort by newest comments button.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672">public</span><span style="color:#F92672"> static</span><span> </span><span style="color:#A6E22E;text-decoration:underline">Boolean</span><span style="color:#A6E22E"> SortByNewestComments</span><span style="color:#F8F8F2">(</span><span style="color:#A6E22E;text-decoration:underline">IWebDriver</span><span style="color:#F8F8F2"> driver)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F92672">    try</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F8F8F2">        Thread.</span><span style="color:#A6E22E">Sleep</span><span style="color:#F8F8F2">(</span><span style="color:#AE81FF">5000</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#88846F">        // make into function</span></span>
<span class="line"><span style="color:#F92672">        string</span><span style="color:#F8F8F2"> sortXPath </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> Constants.YahooXPaths.sortButtonXPath;</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">        var</span><span style="color:#F8F8F2"> sortEle </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> driver.</span><span style="color:#A6E22E">FindElement</span><span style="color:#F8F8F2">(By.</span><span style="color:#A6E22E">XPath</span><span style="color:#F8F8F2">(sortXPath));</span></span>
<span class="line"><span style="color:#F8F8F2">        sortEle.</span><span style="color:#A6E22E">Click</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">        Thread.</span><span style="color:#A6E22E">Sleep</span><span style="color:#F8F8F2">(</span><span style="color:#AE81FF">1000</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F92672">        string</span><span style="color:#F8F8F2"> createdXPath </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> Constants.YahooXPaths.sortByCreatedAtXPath;</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">        var</span><span style="color:#F8F8F2"> createdEle </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> driver.</span><span style="color:#A6E22E">FindElement</span><span style="color:#F8F8F2">(By.</span><span style="color:#A6E22E">XPath</span><span style="color:#F8F8F2">(createdXPath));</span></span>
<span class="line"><span style="color:#F8F8F2">        createdEle.</span><span style="color:#A6E22E">Click</span><span style="color:#F8F8F2">();</span></span>
<span class="line"><span style="color:#F8F8F2">        Thread.</span><span style="color:#A6E22E">Sleep</span><span style="color:#F8F8F2">(</span><span style="color:#AE81FF">1000</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#AE81FF"> true</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F92672">    catch</span><span style="color:#F8F8F2"> (</span><span style="color:#A6E22E;text-decoration:underline">NoSuchElementException</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F92672">        return</span><span style="color:#AE81FF"> false</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>SO the code above is pretty simple, we just click on the sort button, then click on the sort by created at button.</p>
<p>NExt we need to show all comments.</p>
<pre class="astro-code monokai" style="background-color:#272822;color:#F8F8F2; overflow-x: auto;" tabindex="0"><code><span class="line"><span style="color:#F92672">public</span><span style="color:#F92672"> static</span><span style="color:#F92672"> void</span><span style="color:#A6E22E"> ShowAllComments</span><span style="color:#F8F8F2">(</span><span style="color:#A6E22E;text-decoration:underline">IWebDriver</span><span style="color:#F8F8F2"> driver)</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#88846F">    // sort by newest</span></span>
<span class="line"><span style="color:#F92672">    string</span><span style="color:#F8F8F2"> showMoreXPath </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> Constants.YahooXPaths.showMoreXPath;</span></span>
<span class="line"><span style="color:#F92672">    int</span><span style="color:#F8F8F2"> numFailure </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> 0</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F92672">    for</span><span style="color:#F8F8F2"> (</span><span style="color:#F92672">int</span><span style="color:#F8F8F2"> i </span><span style="color:#F92672">=</span><span style="color:#AE81FF"> 0</span><span style="color:#F8F8F2">; i </span><span style="color:#F92672">&#x3C;</span><span style="color:#AE81FF"> 100</span><span style="color:#F8F8F2">; i</span><span style="color:#F92672">++</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">    {</span></span>
<span class="line"><span style="color:#F92672">        try</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#66D9EF;font-style:italic">            var</span><span style="color:#F8F8F2"> element </span><span style="color:#F92672">=</span><span style="color:#F8F8F2"> driver.</span><span style="color:#A6E22E">FindElement</span><span style="color:#F8F8F2">(By.</span><span style="color:#A6E22E">XPath</span><span style="color:#F8F8F2">(showMoreXPath));</span></span>
<span class="line"><span style="color:#88846F">            // need a delay to show elements</span></span>
<span class="line"><span style="color:#88846F">            // click on element using javascript</span></span>
<span class="line"><span style="color:#F8F8F2">            ((</span><span style="color:#A6E22E;text-decoration:underline">IJavaScriptExecutor</span><span style="color:#F8F8F2">)driver).</span><span style="color:#A6E22E">ExecuteScript</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"arguments[0].click();"</span><span style="color:#F8F8F2">, element);</span></span>
<span class="line"><span style="color:#88846F">            // element.Click();</span></span>
<span class="line"><span style="color:#F8F8F2">            Thread.</span><span style="color:#A6E22E">Sleep</span><span style="color:#F8F8F2">(</span><span style="color:#AE81FF">300</span><span style="color:#F8F8F2">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F92672">        catch</span><span style="color:#F8F8F2"> (</span><span style="color:#A6E22E;text-decoration:underline">NoSuchElementException</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        {</span></span>
<span class="line"><span style="color:#F8F8F2">            numFailure</span><span style="color:#F92672">++</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F92672">            if</span><span style="color:#F8F8F2"> (numFailure </span><span style="color:#F92672">></span><span style="color:#AE81FF"> 4</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            {</span></span>
<span class="line"><span style="color:#F8F8F2">                Console.</span><span style="color:#A6E22E">WriteLine</span><span style="color:#F8F8F2">(i </span><span style="color:#F92672">+</span><span style="color:#E6DB74"> " Element does not exist! Stopping Loop"</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F92672">                break</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        } </span><span style="color:#F92672">catch</span><span style="color:#F8F8F2">(</span><span style="color:#A6E22E;text-decoration:underline">OpenQA</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">Selenium</span><span style="color:#F8F8F2">.</span><span style="color:#A6E22E;text-decoration:underline">ElementClickInterceptedException</span><span style="color:#F8F8F2"> ex) {</span></span>
<span class="line"><span style="color:#F8F8F2">            Console.</span><span style="color:#A6E22E">WriteLine</span><span style="color:#F8F8F2">(</span><span style="color:#E6DB74">"ElementClickInterceptedException"</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F8F8F2">            numFailure</span><span style="color:#F92672">++</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">            Console.</span><span style="color:#A6E22E">WriteLine</span><span style="color:#F8F8F2">(ex);</span></span>
<span class="line"><span style="color:#F92672">            if</span><span style="color:#F8F8F2"> (numFailure </span><span style="color:#F92672">></span><span style="color:#AE81FF"> 4</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">            {</span></span>
<span class="line"><span style="color:#F8F8F2">                Console.</span><span style="color:#A6E22E">WriteLine</span><span style="color:#F8F8F2">(i </span><span style="color:#F92672">+</span><span style="color:#E6DB74"> " ElementClickInterceptedException! Stopping Loop"</span><span style="color:#F8F8F2">);</span></span>
<span class="line"><span style="color:#F92672">                break</span><span style="color:#F8F8F2">;</span></span>
<span class="line"><span style="color:#F8F8F2">            }</span></span>
<span class="line"><span style="color:#F8F8F2">        }</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>The code above is pretty simple, we just click on the show more button until it doesn’t exist anymore or we have tried 100 times.</p>
<p>To view detailed documentation of the code, please visit the <a href="https://dli-invest.github.io/conscrap">conscrap</a> page.</p>
<p>For the time being for use in order projects, I have not published the code to nuget. If you would like to use the code, please clone the repo and build it yourself. An example of this is the <a href="https://github.com/dli-invest/stonk_reports">dli-invest</a> project.</p> <h5>Related Projects</h5> <a href="https://github.com/dli-invest/conscrap" style="text-decoration:none;width:200px;text-align:center"> <h3> <div class="rounded-md px-2 py-1 text-xs font-semibold bg-green-400 text-green-900">conscrap</div> </h3> </a> </astro-slot></content></div></div></div></div><!--astro:end--></astro-island>  </div> <div class="mx-auto max-w-screen-lg px-3 py-6"><div class="no-print border-t border-gray-600 pt-5"><div class="text-sm text-gray-200">© Copyright <!-- -->2025<!-- --> by <!-- -->Dhanushka&#x27;s Blog<!-- -->. Built with ♥ by<!-- --> <a class="text-cyan-400 hover:underline" href="https://github.com/dhanushka2001" target="_blank" rel="noopener noreferrer">Dhanushka</a>. Last updated on <!-- -->2025-07-08<!-- -->.</div></div><script src="https://cdn.botpress.cloud/webchat/v0/inject.js"></script><script src="https://mediafiles.botpress.cloud/0df54034-3318-451a-aed0-3923a4ee25a5/webchat/config.js" defer=""></script></div> </body></html>